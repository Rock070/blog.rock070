<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>分類: CI/CD 敏捷開發 - Rock070 Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="">





<meta name="keywords" content="網頁前端,frontend,modern web, vue, ES6, Jest, CSS pattern, Unit Test">








<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">


<link rel="stylesheet" href="/blog.rock070/css/style.css">






<meta name="generator" content="Hexo 5.4.0"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/blog.rock070/">
                
                <span>Rock070</span>
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/blog.rock070/about">關於我</a>
            
            <a class="navbar-item "
               href="/blog.rock070/categories">文章分類</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            
            <a class="navbar-item" target="_blank" title="Medium" href="https://medium.com/@mirthful_satin_dinosaur_426">
                
                <i class="fa-brands fa-medium"></i>
                
            </a>
               
            
            
        </div>
    </div>
</nav>

    <section class="section section-heading">
    <div class="container">
        <div class="content">
            <h5><i class="far fa-folder"></i>CI/CD 敏捷開發</h5>
        </div>
    </div>
</section>
<section class="section">
    <div class="container">
    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/blog.rock070/2022/06/22/note-agile-development/" itemprop="url">緯育 Tibame【手把手帶你跑敏捷】如何落實技術實踐心得</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2022-06-22T13:15:34.000Z" itemprop="datePublished">2022年6月22日</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/blog.rock070/categories/CI-CD-%E6%95%8F%E6%8D%B7%E9%96%8B%E7%99%BC/">CI/CD 敏捷開發</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            16 分钟 讀完 (約 2396 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><p><a target="_blank" rel="noopener" href="https://hqtraining.tibame.com/course/453/">課程網址</a></p>
<h2 id="心得"><a href="#心得" class="headerlink" title="心得"></a>心得</h2><p>此課程讓我對敏捷式開發有更深入的了解，不是只停留在敏捷的大原則，而是從開發面切入講解，理論面偏重，個人認為較適合已經有 CI/CD 基本操作經驗者修課。</p>
<p>在現代敏捷式開發架構中，「自動化」變得非常重要，在開發過程中，為了降低產品上線的時間成本，大致上會有以下的流程：</p>
<h2 id="一、開發流程"><a href="#一、開發流程" class="headerlink" title="一、開發流程"></a>一、開發流程</h2><h3 id="1-使用版本控制-自動化持續地整合"><a href="#1-使用版本控制-自動化持續地整合" class="headerlink" title="1. 使用版本控制 + 自動化持續地整合"></a>1. 使用版本控制 + 自動化持續地整合</h3><figure class="highlight md hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">持續整合意思是高頻率的把開發中的程式碼合到主線上，並到正式環境上建置，出現問題時可以立即發現並修正。</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-自動化測試"><a href="#2-自動化測試" class="headerlink" title="2. 自動化測試"></a>2. 自動化測試</h3><p>   在正式環境建置之後，代表程式碼可以被編譯，但功能使用上還是可能會出現錯誤，所以需要撰寫自動化測試來測試功能，好處多多，可以在將來放心的重構程式碼，達到一樣的功能規格。</p>
<h3 id="3-自動化佈署"><a href="#3-自動化佈署" class="headerlink" title="3. 自動化佈署"></a>3. 自動化佈署</h3><figure class="highlight md hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">相對傳統部署（單一環境、直接覆蓋新版本、出錯回復慢、服務易中斷）藍綠部署 + 金絲雀部署 + 自動化部署，將微服務切成好幾個 server、透過 load-balancer 將使用者分配到不同的群組，使得部署可以逐步進行，先部署到一部分的使用者，若無問題，逐步直至到全部的使用者，若有問題，則會自動 roll back，停止部署，更換舊版本。</span><br></pre></td></tr></tbody></table></figure>

<h3 id="4-自動化監測"><a href="#4-自動化監測" class="headerlink" title="4. 自動化監測"></a>4. 自動化監測</h3><figure class="highlight md hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在 CI/CD 的過程中，難免會有錯誤的發生，所以自動化監測可以幫助「即時」處理錯誤，並通知開發人員處理。</span><br></pre></td></tr></tbody></table></figure>

<p>​</p>
<h2 id="二、敏捷開發的好處"><a href="#二、敏捷開發的好處" class="headerlink" title="二、敏捷開發的好處"></a>二、敏捷開發的好處</h2><ul>
<li>最低化的使用者體驗影響</li>
<li>降低總開發時間</li>
<li>降低建置、部署的時間成本</li>
<li>允許大膽重構程式碼，提高編譯效率</li>
</ul>
<h2 id="三、敏捷開發的缺點"><a href="#三、敏捷開發的缺點" class="headerlink" title="三、敏捷開發的缺點"></a>三、敏捷開發的缺點</h2><ul>
<li>環境較多，需要的主機也較多，導致成本高</li>
<li>初期需要花大量時間架構自動化流程</li>
</ul>
<h2 id="筆記"><a href="#筆記" class="headerlink" title="筆記"></a>筆記</h2><h2 id="一、過度設計-over-design"><a href="#一、過度設計-over-design" class="headerlink" title="一、過度設計(over design)"></a>一、過度設計(over design)</h2><h3 id="1-什麼是過度設計-over-design"><a href="#1-什麼是過度設計-over-design" class="headerlink" title="1. 什麼是過度設計(over design)"></a>1. 什麼是過度設計(over design)</h3><p>提供的功能比需求多太多，很多甚至用不到</p>
<p>例子：瑞士刀、手機預設 APP</p>
<h3 id="2-過度設計造成的問題"><a href="#2-過度設計造成的問題" class="headerlink" title="2. 過度設計造成的問題"></a>2. 過度設計造成的問題</h3><p>浪費時間、增加複雜度、降低可維護性、可讀性</p>
<h3 id="3-情境解說"><a href="#3-情境解說" class="headerlink" title="3. 情境解說"></a>3. 情境解說</h3><p>常見情況有「我想這個以後會用得到」。</p>
<p>保持 KISS 原則：Keep It Sample and Stupid</p>
<p>使一般人都可以看得懂</p>
<h2 id="二、結隊編程-Pair-Programming-–-多一雙手會更快"><a href="#二、結隊編程-Pair-Programming-–-多一雙手會更快" class="headerlink" title="二、結隊編程(Pair Programming) – 多一雙手會更快"></a>二、結隊編程(Pair Programming) – 多一雙手會更快</h2><p>結隊編程：兩人一起共同寫扣，一人口頭敘述，一人寫 code，從而互相學習，從討論中提高效率</p>
<p>好處：知識傳播、互相監督</p>
<h2 id="三、持續整合-CI-每個人都伸手來摸你的Code，誰來整合"><a href="#三、持續整合-CI-每個人都伸手來摸你的Code，誰來整合" class="headerlink" title="三、持續整合(CI) - 每個人都伸手來摸你的Code，誰來整合"></a>三、持續整合(CI) - 每個人都伸手來摸你的Code，誰來整合</h2><p>持續整合，其實就是大家在利用版本控制遠端開發的時候，經常性的將本地端的 code 合併到遠端的 master 內，藉此降低衝突的發生，也可以持續的測試在正式環境是否一切正常。</p>
<p>持續整合的工具 Jankins</p>
<ul>
<li>可以有多種方法可以觸發自動建置，例如：每天早上、每次提交時…等等</li>
</ul>
<p>透過自動化整合的工具，可以持續交付、建置程式碼到環境上（包含開發、測試、客戶測試、正式），最好的實踐就是每天整合，需要把測試的功能也整合到 CI 的工具上，有發生問題的時候應該設定通知給開發團隊，且應該把修復 CI 作為優先處理。</p>
<h2 id="四、自動化測試-Automation-Test-不做自動化，就等肝硬化"><a href="#四、自動化測試-Automation-Test-不做自動化，就等肝硬化" class="headerlink" title="四、自動化測試(Automation Test) - 不做自動化，就等肝硬化"></a>四、自動化測試(Automation Test) - 不做自動化，就等肝硬化</h2><h3 id="1-單元測試"><a href="#1-單元測試" class="headerlink" title="1. 單元測試"></a>1. 單元測試</h3><ul>
<li><p>可以在開發早期就發現問題</p>
</li>
<li><p>符合 FIRST 原則</p>
<ul>
<li>Fast</li>
<li>Independent</li>
<li>Repeatable</li>
<li>Self-Validating</li>
<li>Timely(TDD 概念)<br>測試要能快速、獨立而不會互相影響、可以重複執行、並自我驗證，說明哪個測試成功了、即時性的，最好是在寫 code 之前就寫測試</li>
</ul>
</li>
<li><p>3A 原則</p>
<ul>
<li>arrange 目標物件、參數、預期結果</li>
<li>act 驗證邏輯</li>
<li>assert 驗證結果是否符合預期</li>
</ul>
</li>
</ul>
<h3 id="2-整合測試（單元合在一起"><a href="#2-整合測試（單元合在一起" class="headerlink" title="2. 整合測試（單元合在一起"></a>2. 整合測試（單元合在一起</h3><p>把多個程式模組合一起進行驗證，例如：資料庫測試、API 接口測試、傳輸協定的驗證。</p>
<h3 id="3-E-to-E-測試（從頭到尾）"><a href="#3-E-to-E-測試（從頭到尾）" class="headerlink" title="3. E to E 測試（從頭到尾）"></a>3. E to E 測試（從頭到尾）</h3><p>以使用者行為進行測試，又屬於「黑箱測試」。</p>
<h3 id="測試經常會被工程師以各種理由逃避，例如"><a href="#測試經常會被工程師以各種理由逃避，例如" class="headerlink" title="測試經常會被工程師以各種理由逃避，例如"></a>測試經常會被工程師以各種理由逃避，例如</h3><ol>
<li>開發時間不夠</li>
<li>不會寫測試</li>
<li>維護測試很花時間</li>
<li>跑測試也很花時間</li>
</ol>
<h3 id="測試帶來的好處"><a href="#測試帶來的好處" class="headerlink" title="測試帶來的好處"></a>測試帶來的好處</h3><ol>
<li>可以專心在開發</li>
<li>可以放心大膽重構程式碼，提高質量</li>
<li>遇到 bug 就把測試補上，避免重複的問題</li>
<li>大量降低建置的時間成本</li>
</ol>
<h3 id="測試的進階實踐-TDD-Test-Driven-Development-測試驅動開發"><a href="#測試的進階實踐-TDD-Test-Driven-Development-測試驅動開發" class="headerlink" title="測試的進階實踐 TDD (Test-Driven Development) 測試驅動開發"></a>測試的進階實踐 TDD (Test-Driven Development) 測試驅動開發</h3><ul>
<li>測試先寫，再寫 code</li>
<li>先釐清需求，列出實例化需求</li>
<li>TDD 的循環：綠燈、紅燈、重構</li>
<li>排列需求逐步增加產品代碼</li>
<li>即時重構</li>
<li>測試全通過 -&gt; 產品完成</li>
</ul>
<h3 id="自動化測試總結"><a href="#自動化測試總結" class="headerlink" title="自動化測試總結"></a>自動化測試總結</h3><p>可以將測試整合在 CI 裡面，通過自動化建置後，進行自動化測試，若產生錯誤，一樣會通知開發人員。</p>
<p><code>大量的單元測試</code> + <code>適當的整合測試</code> + <code>少量的 End-to-End 測試</code> ＝ <code>幫助維持開發速度</code>。</p>
<h2 id="五、重構-Refactor-–-改善既有的程式碼"><a href="#五、重構-Refactor-–-改善既有的程式碼" class="headerlink" title="五、重構(Refactor) – 改善既有的程式碼"></a>五、重構(Refactor) – 改善既有的程式碼</h2><p>所謂重構，就是在不改變程式碼外在行為（例如：元件結合、API 接口）的情況下，改變內部行為。</p>
<h3 id="重構的好處"><a href="#重構的好處" class="headerlink" title="重構的好處"></a>重構的好處</h3><ol>
<li>幫助找到 bug，重構需要提高對程式碼的理解，也可以幫助你更好的找到程式漏洞。</li>
<li>提高編程速度: 有良好的設計添加新功能才更容易、理解度高的程式碼也更好維護。</li>
</ol>
<h3 id="什麼時候該重構"><a href="#什麼時候該重構" class="headerlink" title="什麼時候該重構"></a>什麼時候該重構</h3><ol>
<li>三次法則：功能經常重複使用，達三次以上的時候</li>
<li>添加功能時：<ul>
<li>理解架構</li>
<li>調整架構</li>
<li>下次更容易</li>
</ul>
</li>
<li>修補錯誤時：修改掉原本的問題</li>
</ol>
<h3 id="程式碼的壞味道"><a href="#程式碼的壞味道" class="headerlink" title="程式碼的壞味道"></a>程式碼的壞味道</h3><ol>
<li>重複的程式碼：當要修改一個功能的時候，需要去修改很多地方，就代表這個程式碼需要被重構，或打包來重複使用。</li>
<li>過長函式（不容易理解）</li>
<li>過長參數列</li>
</ol>
<p>重構後的程式碼必須要經過測試（單元測試、整合測試、End to End 測試）</p>
<h2 id="六、持續交付-CD-–-系統維護中，請稍候"><a href="#六、持續交付-CD-–-系統維護中，請稍候" class="headerlink" title="六、持續交付(CD) – 系統維護中，請稍候"></a>六、持續交付(CD) – 系統維護中，請稍候</h2><ul>
<li>Continuous delivery 持續交付</li>
<li>Continuous deploy 持續部署</li>
</ul>
<p>符合敏捷原則，在 CI 與自動化測試的輔助下進行。，持續地交付產品給客戶。</p>
<h3 id="良好的-CD-流程"><a href="#良好的-CD-流程" class="headerlink" title="良好的 CD 流程"></a>良好的 CD 流程</h3><h3 id="1-傳統部署"><a href="#1-傳統部署" class="headerlink" title="1. 傳統部署"></a>1. 傳統部署</h3><figure class="highlight md hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-bullet">-</span> 環境單一，直接覆蓋新版本</span><br><span class="line"><span class="hljs-bullet">-</span> 簡單成本低</span><br><span class="line"><span class="hljs-bullet">-</span> 服務會中斷</span><br><span class="line"><span class="hljs-bullet">-</span> 出錯時回覆問題也慢</span><br><span class="line"><span class="hljs-bullet">-</span> 適合用在測試環境上</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://i.imgur.com/v6tplPB.png" alt="img"></p>
<h3 id="2-傳統部署-feature-toggle"><a href="#2-傳統部署-feature-toggle" class="headerlink" title="2. 傳統部署 + feature toggle"></a>2. 傳統部署 + feature toggle</h3><figure class="highlight md hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-bullet"> -</span> 環境單一，直接覆蓋新版本</span><br><span class="line"><span class="hljs-bullet">-</span> 簡單成本低</span><br><span class="line"><span class="hljs-bullet">-</span> 服務會中斷</span><br><span class="line"><span class="hljs-bullet">-</span> 切換 toggle 來開放新功能</span><br><span class="line"><span class="hljs-bullet">-</span> 出現問題時把 toggle 切換</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://i.imgur.com/Kbna9GM.png" alt="img"></p>
<h3 id="3-金絲雀部署"><a href="#3-金絲雀部署" class="headerlink" title="3. 金絲雀部署"></a>3. 金絲雀部署</h3><figure class="highlight md hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">以前礦工在挖掘時，不是到礦道內是否有毒，所以利用金絲雀來做測試，因為金絲雀對有毒氣體非常敏感。</span><br><span class="line"><span class="hljs-bullet">-</span> 多個環境，慢慢覆蓋新版本</span><br><span class="line"><span class="hljs-bullet">-</span> 容錯率高，發生問題立刻回覆</span><br><span class="line"><span class="hljs-bullet">-</span> 使用者體驗影響較小</span><br><span class="line"><span class="hljs-bullet">-</span> 若沒自動化流程過程繁瑣</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://i.imgur.com/sUulBN0.png" alt="img"></p>
<h3 id="4-藍綠部署"><a href="#4-藍綠部署" class="headerlink" title="4. 藍綠部署"></a>4. 藍綠部署</h3><figure class="highlight md hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-bullet">-</span> 兩個環境群組(線上、現下) ，線下覆蓋新版本再交換</span><br><span class="line"><span class="hljs-bullet">-</span> 需要有 load-balance 環境</span><br><span class="line"><span class="hljs-bullet">-</span> 需要有 state server</span><br><span class="line"><span class="hljs-bullet">-</span> 不影響使用者</span><br><span class="line"><span class="hljs-bullet">-</span> 發生問題，切回舊版本，容錯率低</span><br><span class="line"><span class="hljs-bullet">-</span> 出錯版本對使用者時間短</span><br><span class="line"><span class="hljs-bullet">-</span> 錯誤版本可以線下修改</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://i.imgur.com/lNUq7pj.png" alt="img"><br><img src="https://i.imgur.com/HmqBMd3.png" alt="img"></p>
<h3 id="5-藍綠部署-金絲雀-自動化"><a href="#5-藍綠部署-金絲雀-自動化" class="headerlink" title="5. 藍綠部署 + 金絲雀 + 自動化"></a>5. 藍綠部署 + 金絲雀 + 自動化</h3><figure class="highlight md hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-bullet">-</span> 自動化部署，一段時間後逐漸增量</span><br><span class="line">（切成四個 server，逐一上服務，沒出現錯誤就繼續執行）</span><br><span class="line"><span class="hljs-bullet">-</span> 超高容錯，發生問題就切回舊版</span><br><span class="line"><span class="hljs-bullet">-</span> 使用者影響最小化（四個 server 逐步部署）</span><br><span class="line"><span class="hljs-bullet">-</span> 需要良好的監控服務（例如：重啟 container、有 bug 通知開發人員...等）</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://i.imgur.com/6NcZIHo.png" alt="img"></p>
<h3 id="完整的-CI-CD-流程"><a href="#完整的-CI-CD-流程" class="headerlink" title="完整的 CI/CD 流程"></a>完整的 CI/CD 流程</h3><p><code>正式環境 / UAT 環境</code></p>
<p>↑</p>
<p><code>版本控制 -&gt; CI 伺服器 -&gt; 自動化測試 -&gt; 發布版本控制 -&gt;</code></p>
<p>↑</p>
<p><code>開發環境 / PC / Local</code></p>
<h2 id="課程重點"><a href="#課程重點" class="headerlink" title="課程重點"></a>課程重點</h2><ul>
<li>使用 Jenkins 等工具來運行 CI/CD</li>
<li>版本控制是必須的</li>
<li>自動化建置</li>
<li>自動化測試</li>
<li>自動化部署</li>
<li>自動化監控</li>
</ul>
</body></html>
    
    </div>
    
    
</article>




    
    
    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2023 Rock070&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" target="_blank" rel="noopener" href="https://github.com/Rock070">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>




<script src="/blog.rock070/js/script.js"></script>


    
</body>
</html>